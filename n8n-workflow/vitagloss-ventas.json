{
  "name": "VitaGloss RD â€” AutomatizaciÃ³n de Ventas Web",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "nuevo-pedido",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "ğŸ“¦ Nuevo Pedido Web",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ recibido: true, orderId: $json.body.orderId }) }}",
        "options": {}
      },
      "id": "respond-webhook",
      "name": "âœ… Confirmar recepciÃ³n",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [460, 180]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "order-id",
              "name": "orderId",
              "value": "={{ $json.body.orderId }}",
              "type": "string"
            },
            {
              "id": "cliente-nombre",
              "name": "clienteNombre",
              "value": "={{ $json.body.nombre }}",
              "type": "string"
            },
            {
              "id": "cliente-wa",
              "name": "clienteWhatsapp",
              "value": "={{ $json.body.whatsapp }}",
              "type": "string"
            },
            {
              "id": "total",
              "name": "total",
              "value": "={{ $json.body.total }}",
              "type": "number"
            },
            {
              "id": "items-text",
              "name": "itemsTexto",
              "value": "={{ $json.body.items.map(i => `  â€¢ ${i.nombre} x${i.cantidad} â€” RD$${i.precio * i.cantidad}`).join('\\n') }}",
              "type": "string"
            },
            {
              "id": "ref-code",
              "name": "refCode",
              "value": "={{ $json.body.refCode || '' }}",
              "type": "string"
            },
            {
              "id": "mensaje-vendedor",
              "name": "mensajeVendedor",
              "value": "={{ 'ğŸ›’ *NUEVO PEDIDO WEB*\\n\\n' + 'ğŸ‘¤ Cliente: *' + $json.body.nombre + '*' + ($json.body.whatsapp ? '\\nğŸ“± WA: ' + $json.body.whatsapp : '') + '\\n\\nğŸ“‹ *Productos:*\\n' + $json.body.items.map(i => '  â€¢ ' + i.nombre + ' x' + i.cantidad + ' â€” RD$' + (i.precio * i.cantidad).toLocaleString()).join('\\n') + '\\n\\nğŸ’° *Total: RD$' + $json.body.total.toLocaleString() + '*' + ($json.body.refCode ? '\\n\\nğŸ”— Referido: ' + $json.body.refCode : '') + '\\n\\nâ° ' + new Date().toLocaleString('es-DO', { timeZone: 'America/Santo_Domingo' }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "set-datos",
      "name": "ğŸ“ Preparar datos",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [460, 400]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:3001/send",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key","value": "={{ $vars.WA_SECRET }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $vars.VENDOR_PHONE }}"
            },
            {
              "name": "text",
              "value": "={{ $('ğŸ“ Preparar datos').item.json.mensajeVendedor }}"
            }
          ]
        },
        "options": {}
      },
      "id": "wa-vendor-notify",
      "name": "ğŸ“² Notificar vendedor WA",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [680, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{ $('ğŸ“ Preparar datos').item.json.clienteWhatsapp }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-client-wa",
      "name": "Â¿Tiene WA el cliente?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [900, 400]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:3001/send",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key","value": "={{ $vars.WA_SECRET }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('ğŸ“ Preparar datos').item.json.clienteWhatsapp }}"
            },
            {
              "name": "text",
              "value": "=Â¡Hola *{{ $('ğŸ“ Preparar datos').item.json.clienteNombre }}*! ğŸ‘‹\\n\\nGracias por tu pedido en VitaGloss RD. âœ…\\n\\nHemos recibido tu solicitud:\\n{{ $('ğŸ“ Preparar datos').item.json.itemsTexto }}\\n\\nğŸ’° *Total: RD${{ $('ğŸ“ Preparar datos').item.json.total.toLocaleString() }}*\\n\\nUn representante te contactarÃ¡ pronto para confirmar el envÃ­o y el pago. Â¡Gracias por confiar en nosotros! ğŸ™"
            }
          ]
        },
        "options": {}
      },
      "id": "wa-client-confirm",
      "name": "ğŸ“© Confirmar al cliente",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1120, 300]
    },
    {
      "parameters": {
        "unit": "hours",
        "amount": 3
      },
      "id": "wait-followup",
      "name": "â³ Esperar 3 horas",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [1120, 520],
      "webhookId": "followup-wait"
    },
    {
      "parameters": {
        "method": "GET",
        "url": "={{ $vars.API_URL }}/orders/{{ $('ğŸ“ Preparar datos').item.json.orderId }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $vars.ADMIN_TOKEN }}"
            }
          ]
        },
        "options": {}
      },
      "id": "check-order-status",
      "name": "ğŸ” Verificar estado pedido",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1340, 520]
    },
    {
      "parameters": {
        "conditions": {
          "options": {},
          "conditions": [
            {
              "leftValue": "={{ $json.order.estado }}",
              "rightValue": "nuevo",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-still-nuevo",
      "name": "Â¿Sigue sin contactar?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1560, 520]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:3001/send",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key","value": "={{ $vars.WA_SECRET }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $vars.VENDOR_PHONE }}"
            },
            {
              "name": "text",
              "value": "=âš ï¸ *RECORDATORIO â€” Pedido sin atender*\\n\\nEl pedido de *{{ $('ğŸ“ Preparar datos').item.json.clienteNombre }}* lleva 3 horas sin confirmarse.\\n\\nğŸ’° Total: RD${{ $('ğŸ“ Preparar datos').item.json.total.toLocaleString() }}\\n\\nğŸ“‹ ID: {{ $('ğŸ“ Preparar datos').item.json.orderId }}\\n\\nÂ¡ContÃ¡ctalo ahora para no perder la venta! ğŸ”¥"
            }
          ]
        },
        "options": {}
      },
      "id": "wa-followup",
      "name": "ğŸ”” Follow-up al vendedor",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1780, 420]
    }
  ],
  "connections": {
    "ğŸ“¦ Nuevo Pedido Web": {
      "main": [
        [
          { "node": "âœ… Confirmar recepciÃ³n", "type": "main", "index": 0 },
          { "node": "ğŸ“ Preparar datos",     "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ“ Preparar datos": {
      "main": [
        [{ "node": "ğŸ“² Notificar vendedor WA", "type": "main", "index": 0 }]
      ]
    },
    "ğŸ“² Notificar vendedor WA": {
      "main": [
        [{ "node": "Â¿Tiene WA el cliente?", "type": "main", "index": 0 }]
      ]
    },
    "Â¿Tiene WA el cliente?": {
      "main": [
        [{ "node": "ğŸ“© Confirmar al cliente", "type": "main", "index": 0 }],
        [{ "node": "â³ Esperar 3 horas",      "type": "main", "index": 0 }]
      ]
    },
    "ğŸ“© Confirmar al cliente": {
      "main": [
        [{ "node": "â³ Esperar 3 horas", "type": "main", "index": 0 }]
      ]
    },
    "â³ Esperar 3 horas": {
      "main": [
        [{ "node": "ğŸ” Verificar estado pedido", "type": "main", "index": 0 }]
      ]
    },
    "ğŸ” Verificar estado pedido": {
      "main": [
        [{ "node": "Â¿Sigue sin contactar?", "type": "main", "index": 0 }]
      ]
    },
    "Â¿Sigue sin contactar?": {
      "main": [
        [{ "node": "ğŸ”” Follow-up al vendedor", "type": "main", "index": 0 }],
        []
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": ""
  },
  "staticData": null,
  "tags": ["vitagloss", "ventas", "whatsapp"],
  "triggerCount": 1,
  "updatedAt": "2026-02-24T00:00:00.000Z",
  "versionId": "1"
}

